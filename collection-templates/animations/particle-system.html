<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{{BRAND_NAME}} - Partikel-System</title>
<style>
  *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
  :root{
    --dark-bg:{{BG}};--cyan:{{PRIMARY}};--cyan-dark:{{PRIMARY_DARK}};--cloud:{{TEXT}};--muted:{{MUTED}};
    --card-bg:#1e293b;--border:#334155;
  }
  body{font-family:system-ui,-apple-system,sans-serif;background:var(--dark-bg);color:var(--cloud);overflow:hidden;height:100vh;width:100vw}

  canvas{position:fixed;inset:0;z-index:0}

  /* Title Overlay */
  .title-overlay{position:fixed;top:24px;left:50%;transform:translateX(-50%);z-index:10;text-align:center;pointer-events:none}
  .title-overlay h1{font-size:1.6rem;font-weight:800;opacity:.6}
  .title-overlay h1 span{color:var(--cyan)}
  .title-overlay p{font-size:.8rem;color:var(--muted);margin-top:4px}

  /* Controls Panel */
  .controls{position:fixed;bottom:24px;right:24px;background:rgba(30,41,59,.92);border:1px solid var(--border);border-radius:16px;padding:20px;z-index:10;width:260px;backdrop-filter:blur(8px)}
  .controls h3{font-size:.85rem;font-weight:700;margin-bottom:16px;display:flex;align-items:center;gap:8px}
  .controls h3 span{color:var(--cyan)}
  .control-row{margin-bottom:14px}
  .control-row:last-child{margin-bottom:0}
  .control-label{display:flex;justify-content:space-between;font-size:.78rem;color:var(--muted);margin-bottom:6px}
  .control-label .val{color:var(--cloud);font-weight:600}
  input[type="range"]{-webkit-appearance:none;appearance:none;width:100%;height:6px;background:var(--border);border-radius:99px;outline:none;cursor:pointer}
  input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;border-radius:50%;background:var(--cyan);cursor:pointer;border:2px solid var(--dark-bg)}
  input[type="range"]::-moz-range-thumb{width:18px;height:18px;border-radius:50%;background:var(--cyan);cursor:pointer;border:2px solid var(--dark-bg)}

  .color-row{display:flex;gap:8px;margin-top:4px}
  .color-btn{width:28px;height:28px;border-radius:8px;border:2px solid transparent;cursor:pointer;transition:border-color .2s,transform .2s}
  .color-btn.active{border-color:var(--cloud);transform:scale(1.1)}
  .color-btn:hover{transform:scale(1.1)}

  .hint{position:fixed;bottom:24px;left:24px;font-size:.75rem;color:var(--muted);z-index:10;line-height:1.6;max-width:220px}

  @media(max-width:600px){
    .controls{bottom:12px;right:12px;left:12px;width:auto}
    .hint{display:none}
  }
</style>
</head>
<body>

<canvas id="canvas"></canvas>

<div class="title-overlay">
  <h1>Partikel-<span>System</span></h1>
  <p>Interaktives Canvas-basiertes Partikel-System</p>
</div>

<div class="controls">
  <h3><span>&#9881;</span> Steuerung</h3>
  <div class="control-row">
    <div class="control-label"><span>Partikel-Anzahl</span><span class="val" id="countVal">150</span></div>
    <input type="range" id="countSlider" min="30" max="400" value="150">
  </div>
  <div class="control-row">
    <div class="control-label"><span>Geschwindigkeit</span><span class="val" id="speedVal">1.0</span></div>
    <input type="range" id="speedSlider" min="1" max="30" value="10">
  </div>
  <div class="control-row">
    <div class="control-label"><span>Verbindungsdistanz</span><span class="val" id="distVal">120</span></div>
    <input type="range" id="distSlider" min="40" max="250" value="120">
  </div>
  <div class="control-row">
    <div class="control-label"><span>Farbe</span></div>
    <div class="color-row">
      <div class="color-btn active" style="background:{{PRIMARY}}" data-color="{{PRIMARY_RGB}}" title="Cyan"></div>
      <div class="color-btn" style="background:#6366f1" data-color="99,102,241" title="Indigo"></div>
      <div class="color-btn" style="background:{{WARNING}}" data-color="{{WARNING_RGB}}" title="Amber"></div>
      <div class="color-btn" style="background:#ec4899" data-color="236,72,153" title="Pink"></div>
      <div class="color-btn" style="background:{{SUCCESS}}" data-color="{{SUCCESS_RGB}}" title="Emerald"></div>
      <div class="color-btn" style="background:{{TEXT}}" data-color="248,250,252" title="Weiss"></div>
    </div>
  </div>
</div>

<div class="hint">
  Maus bewegen: Partikel anziehen<br>
  Klicken: Partikel-Explosion<br>
  Regler anpassen: Live-Anderung
</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

let W, H;
let particles = [];
let mouse = { x: -1000, y: -1000, active: false };
let config = {
  count: 150,
  speed: 1.0,
  connectionDist: 120,
  color: '{{PRIMARY_RGB}}',
  mouseRadius: 150,
  mouseForce: 0.02
};

function resize() {
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
}
resize();
window.addEventListener('resize', resize);

// Particle class
class Particle {
  constructor(x, y, vx, vy) {
    this.x = x !== undefined ? x : Math.random() * W;
    this.y = y !== undefined ? y : Math.random() * H;
    this.vx = vx !== undefined ? vx : (Math.random() - 0.5) * 2;
    this.vy = vy !== undefined ? vy : (Math.random() - 0.5) * 2;
    this.size = 1.5 + Math.random() * 2.5;
    this.type = Math.random() > 0.4 ? 'circle' : 'hexagon';
    this.life = 1;
    this.decay = 0; // 0 = permanent, >0 = temporary (burst)
  }

  update() {
    // Mouse interaction
    if (mouse.active) {
      const dx = mouse.x - this.x;
      const dy = mouse.y - this.y;
      const dist = Math.sqrt(dx * dx + dy * dy);
      if (dist < config.mouseRadius && dist > 1) {
        const force = config.mouseForce * (1 - dist / config.mouseRadius);
        this.vx += (dx / dist) * force * 60;
        this.vy += (dy / dist) * force * 60;
      }
    }

    // Damping
    this.vx *= 0.99;
    this.vy *= 0.99;

    this.x += this.vx * config.speed;
    this.y += this.vy * config.speed;

    // Wrap edges
    if (this.x < -20) this.x = W + 20;
    if (this.x > W + 20) this.x = -20;
    if (this.y < -20) this.y = H + 20;
    if (this.y > H + 20) this.y = -20;

    // Decay for burst particles
    if (this.decay > 0) {
      this.life -= this.decay;
    }
  }

  draw() {
    const alpha = this.life * 0.8;
    ctx.fillStyle = `rgba(${config.color},${alpha})`;

    if (this.type === 'hexagon') {
      this.drawHexagon();
    } else {
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
      ctx.fill();
    }
  }

  drawHexagon() {
    const s = this.size * 1.2;
    ctx.beginPath();
    for (let i = 0; i < 6; i++) {
      const angle = (Math.PI / 3) * i - Math.PI / 6;
      const px = this.x + s * Math.cos(angle);
      const py = this.y + s * Math.sin(angle);
      if (i === 0) ctx.moveTo(px, py);
      else ctx.lineTo(px, py);
    }
    ctx.closePath();
    ctx.fill();
  }
}

// Initialize particles
function initParticles() {
  particles = [];
  for (let i = 0; i < config.count; i++) {
    particles.push(new Particle());
  }
}
initParticles();

// Burst effect on click
function burst(x, y) {
  const burstCount = 20;
  for (let i = 0; i < burstCount; i++) {
    const angle = (Math.PI * 2 / burstCount) * i + (Math.random() - 0.5) * 0.5;
    const speed = 3 + Math.random() * 5;
    const p = new Particle(x, y, Math.cos(angle) * speed, Math.sin(angle) * speed);
    p.decay = 0.008 + Math.random() * 0.005;
    p.size = 2 + Math.random() * 3;
    particles.push(p);
  }
}

// Draw connections
function drawConnections() {
  const maxDist = config.connectionDist;
  const maxDistSq = maxDist * maxDist;

  for (let i = 0; i < particles.length; i++) {
    for (let j = i + 1; j < particles.length; j++) {
      const dx = particles[i].x - particles[j].x;
      const dy = particles[i].y - particles[j].y;
      const distSq = dx * dx + dy * dy;

      if (distSq < maxDistSq) {
        const dist = Math.sqrt(distSq);
        const alpha = (1 - dist / maxDist) * 0.3 * particles[i].life * particles[j].life;
        ctx.strokeStyle = `rgba(${config.color},${alpha})`;
        ctx.lineWidth = 0.8;
        ctx.beginPath();
        ctx.moveTo(particles[i].x, particles[i].y);
        ctx.lineTo(particles[j].x, particles[j].y);
        ctx.stroke();
      }
    }
  }
}

// Animation loop
function animate() {
  // Dark background with subtle gradient
  ctx.fillStyle = '{{BG}}';
  ctx.fillRect(0, 0, W, H);

  // Subtle radial glow at center
  const grad = ctx.createRadialGradient(W / 2, H / 2, 0, W / 2, H / 2, Math.max(W, H) * 0.5);
  grad.addColorStop(0, `rgba(${config.color},0.03)`);
  grad.addColorStop(1, 'transparent');
  ctx.fillStyle = grad;
  ctx.fillRect(0, 0, W, H);

  // Mouse glow
  if (mouse.active) {
    const mg = ctx.createRadialGradient(mouse.x, mouse.y, 0, mouse.x, mouse.y, config.mouseRadius);
    mg.addColorStop(0, `rgba(${config.color},0.08)`);
    mg.addColorStop(1, 'transparent');
    ctx.fillStyle = mg;
    ctx.fillRect(0, 0, W, H);
  }

  drawConnections();

  // Update and draw particles
  for (let i = particles.length - 1; i >= 0; i--) {
    particles[i].update();
    particles[i].draw();

    // Remove dead burst particles
    if (particles[i].life <= 0) {
      particles.splice(i, 1);
    }
  }

  requestAnimationFrame(animate);
}
animate();

// Mouse events
canvas.addEventListener('mousemove', (e) => {
  mouse.x = e.clientX;
  mouse.y = e.clientY;
  mouse.active = true;
});

canvas.addEventListener('mouseleave', () => {
  mouse.active = false;
  mouse.x = -1000;
  mouse.y = -1000;
});

canvas.addEventListener('click', (e) => {
  burst(e.clientX, e.clientY);
});

// Touch support
canvas.addEventListener('touchmove', (e) => {
  e.preventDefault();
  const t = e.touches[0];
  mouse.x = t.clientX;
  mouse.y = t.clientY;
  mouse.active = true;
}, { passive: false });

canvas.addEventListener('touchstart', (e) => {
  const t = e.touches[0];
  mouse.x = t.clientX;
  mouse.y = t.clientY;
  mouse.active = true;
  burst(t.clientX, t.clientY);
});

canvas.addEventListener('touchend', () => {
  mouse.active = false;
});

// Controls
const countSlider = document.getElementById('countSlider');
const speedSlider = document.getElementById('speedSlider');
const distSlider = document.getElementById('distSlider');
const countVal = document.getElementById('countVal');
const speedVal = document.getElementById('speedVal');
const distVal = document.getElementById('distVal');

countSlider.addEventListener('input', (e) => {
  const newCount = parseInt(e.target.value);
  countVal.textContent = newCount;
  config.count = newCount;

  // Add or remove particles
  while (particles.length < newCount) {
    particles.push(new Particle());
  }
  // Only remove permanent particles
  let permanentCount = particles.filter(p => p.decay === 0).length;
  let i = particles.length - 1;
  while (permanentCount > newCount && i >= 0) {
    if (particles[i].decay === 0) {
      particles.splice(i, 1);
      permanentCount--;
    }
    i--;
  }
});

speedSlider.addEventListener('input', (e) => {
  config.speed = parseInt(e.target.value) / 10;
  speedVal.textContent = config.speed.toFixed(1);
});

distSlider.addEventListener('input', (e) => {
  config.connectionDist = parseInt(e.target.value);
  distVal.textContent = config.connectionDist;
});

// Color buttons
document.querySelectorAll('.color-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    config.color = btn.dataset.color;
  });
});
</script>
</body>
</html>
